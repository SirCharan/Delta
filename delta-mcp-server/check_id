#!/usr/bin/env python3
"""
Find the correct ETHUSD product ID on Delta Exchange
Run this to verify product ID 3136 is correct
"""

import requests
import json

def find_ethusd_products():
    # Your working API credentials  
    BASE_URL = "https://api.delta.exchange"  # From your .env file
    
    print("ğŸ” Finding ETHUSD products on Delta Exchange...")
    print(f"ğŸ“ Base URL: {BASE_URL}")
    print("=" * 60)
    
    try:
        # Get all products (public endpoint, no auth required)
        response = requests.get(f"{BASE_URL}/v2/products")
        
        if response.status_code != 200:
            print(f"âŒ Failed to get products: {response.status_code}")
            print(f"Response: {response.text}")
            return
        
        products = response.json()
        print(f"âœ… Found {len(products)} total products")
        
        # Find ETH-related products
        eth_products = []
        for product in products:
            symbol = product.get('symbol', '').upper()
            if 'ETH' in symbol and 'USD' in symbol:
                eth_products.append(product)
        
        print(f"\nğŸ¯ Found {len(eth_products)} ETHUSD-related products:")
        print("=" * 60)
        
        for product in eth_products:
            print(f"ğŸ“‹ ID: {product.get('id')}")
            print(f"ğŸ·ï¸  Symbol: {product.get('symbol')}")
            print(f"ğŸ“Š Type: {product.get('contract_type')}")
            print(f"ğŸ“ Description: {product.get('description', 'N/A')}")
            print(f"ğŸŸ¢ Status: {product.get('state', 'N/A')}")
            print(f"ğŸ’° Settlement: {product.get('settling_asset', 'N/A')}")
            print("-" * 40)
        
        # Check specifically for product ID 3136
        product_3136 = None
        for product in products:
            if product.get('id') == 3136:
                product_3136 = product
                break
        
        print(f"\nğŸ¯ Checking Product ID 3136:")
        print("=" * 60)
        if product_3136:
            print(f"âœ… FOUND Product ID 3136!")
            print(f"ğŸ·ï¸  Symbol: {product_3136.get('symbol')}")
            print(f"ğŸ“Š Type: {product_3136.get('contract_type')}")
            print(f"ğŸ“ Description: {product_3136.get('description', 'N/A')}")
            print(f"ğŸŸ¢ Status: {product_3136.get('state', 'N/A')}")
            print(f"ğŸ’° Settlement: {product_3136.get('settling_asset', 'N/A')}")
            
            if 'ETH' in product_3136.get('symbol', '').upper():
                print("ğŸ‰ CONFIRMED: Product ID 3136 is an ETH product!")
            else:
                print("âš ï¸  WARNING: Product ID 3136 is NOT an ETH product!")
                print("ğŸ”§ You may want to use a different product ID")
        else:
            print(f"âŒ Product ID 3136 NOT FOUND!")
            print("ğŸ”§ Available ETH product IDs shown above")
        
        # Show the best ETHUSD perpetual option
        perpetual_eth = None
        for product in eth_products:
            if product.get('contract_type') == 'perpetual_futures':
                perpetual_eth = product
                break
        
        if perpetual_eth:
            print(f"\nğŸ’¡ RECOMMENDED ETHUSD Perpetual:")
            print("=" * 60)
            print(f"ğŸ“‹ Use Product ID: {perpetual_eth.get('id')}")
            print(f"ğŸ·ï¸  Symbol: {perpetual_eth.get('symbol')}")
            print(f"ğŸ“Š Type: {perpetual_eth.get('contract_type')}")
            print(f"ğŸ“ Description: {perpetual_eth.get('description', 'N/A')}")
        
    except Exception as e:
        print(f"âŒ Error: {e}")

if __name__ == "__main__":
    find_ethusd_products()